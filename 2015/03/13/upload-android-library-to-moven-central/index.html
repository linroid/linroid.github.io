<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 提交 library 项目到 Maven Central · linroid</title><meta name="description" content="提交 library 项目到 Maven Central - linroid"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://linroid.com/atom.xml" title="linroid"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/avatar.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Blog</a></li><li class="nav-list-item"><a href="/products/" target="_self" class="nav-list-link">Products</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archives</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="https://instagram.com/linroid/" target="_blank" class="nav-list-link">Instagram</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">提交 library 项目到 Maven Central</h1><div class="post-info">Mar 13, 2015</div><div class="post-content"><p>  将 <a href="http://github.com/linroid/FilterMenu" target="_blank" rel="noopener">FilterMenu</a> 提交到 GitHub 后，在 README.md 的 Getting Started 里仅仅写上</p>
<blockquote>
<p>Download the source to use it as library project</p>
</blockquote>
<p>  这唯一使用途径，居然没有 gradle/maven ?作为 Android Studio 的忠实用户，自己写的库怎么能只提供这么麻烦的方法！！！于是决定把它提交到 Maven Central 中。<br><a id="more"></a></p>
<p>虽然 AS 的 gradle 默认使用的是 jcenter 仓库，但我们只需要提交到 Maven Central 即可，jcenter 会自动同步。  </p>
<p><strong>如果还没有账号先去 Maven Central 注册: <a href="https://issues.sonatype.org/secure/Signup!default.jspa" target="_blank" rel="noopener">Sign up</a> </strong></p>
<p>并到 <a href="https://issues.sonatype.org/secure/CreateIssue.jspa?issuetype=21&amp;pid=10134" target="_blank" rel="noopener">Create Issue</a> 提交工单等待管理员的回复，填 groupId 时，请使用顶级 groupId，比如我只需要填写 <code>com.linroid</code>，就可以发布到任何 <code>com.linroid.*</code> 下的groupId。</p>
<p>我是早上提交的，到晚上0:30的时候收到回复。<a href="http://central.sonatype.org/articles/2014/Feb/27/why-the-wait/" target="_blank" rel="noopener">Why the wait?</a></p>
<blockquote>
<p>Configuration has been prepared, now you can:<br>Deploy snapshot artifacts into repository <a href="https://oss.sonatype.org/content/repositories/snapshots" target="_blank" rel="noopener">https://oss.sonatype.org/content/repositories/snapshots</a><br>Deploy release artifacts into the staging repository <a href="https://oss.sonatype.org/service/local/staging/deploy/maven2" target="_blank" rel="noopener">https://oss.sonatype.org/service/local/staging/deploy/maven2</a><br>Promote staged artifacts into repository ‘Releases’<br>Download snapshot and release artifacts from group <a href="https://oss.sonatype.org/content/groups/public" target="_blank" rel="noopener">https://oss.sonatype.org/content/groups/public</a><br>Download snapshot, release and staged artifacts from staging group <a href="https://oss.sonatype.org/content/groups/staging" target="_blank" rel="noopener">https://oss.sonatype.org/content/groups/staging</a><br>please comment on this ticket when you promoted your first release, thanks</p>
</blockquote>
<p>然后通过下面的方法 Release，再次回复那个 issue，几分钟后又收到回复:</p>
<blockquote>
<p>Central sync is activated for com.linroid. After you successfully release, your component will be published to Central, typically within 10 minutes, though updates to search.maven.org can take up to two hours.</p>
</blockquote>
<h2 id="通过-gradle-mvn-push"><a href="#通过-gradle-mvn-push" class="headerlink" title="通过 gradle-mvn-push"></a>通过 gradle-mvn-push</h2><p> <a href="https://chris.banes.me/" target="_blank" rel="noopener">Chris Banes</a>大神很早前写了一个插件 <a href="https://github.com/chrisbanes/gradle-mvn-push" target="_blank" rel="noopener">gradle-mvn-push</a>(终于有机会用它了^﹏^)，让你通过一条gradle命令就可以自动构建好aar并提交到 Maven Central。下面介绍这个插件的使用方法。</p>
<ul>
<li><p>配置用于上传的<strong>认证信息</strong><br>配置文件默认在<code>${HOME}/.gradle/gradle.properties</code>，如果没有则自己创建。</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NEXUS_USERNAME=linroid</span><br><span class="line">NEXUS_PASSWORD=YOUR_MAVEN_CENTRAL_PASSWORD</span><br><span class="line"></span><br><span class="line">signing.keyId=YOUR_GPG_KEY_ID</span><br><span class="line">signing.password=YOUR_GPG_PASSWORD</span><br><span class="line">signing.secretKeyRingFile=$&#123;HOME&#125;/.gnupg/secring.gpg</span><br></pre></td></tr></table></figure>
<p><code>NEXUS_USERNAME</code> 和 <code>NEXUS_PASSWORD</code> 是你注册的用户名和密码，下面的是用于 GPG 校验的配置信息，关于 GPG 的使用可以参见阮一峰的博文:<a href="http://www.ruanyifeng.com/blog/2013/07/gpg.html" target="_blank" rel="noopener">GPG 入门教程</a></p>
</li>
<li><p>配置<strong>版本信息</strong><br>在你的module目录创建<code>gradle.properties</code>文件，添加配置:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">POM_NAME=Android FilterMenu Library</span><br><span class="line">POM_ARTIFACT_ID=library</span><br><span class="line">POM_PACKAGING=aar</span><br><span class="line">VERSION_NAME=0.1.1</span><br><span class="line">VERSION_CODE=1</span><br><span class="line">GROUP=com.linroid.filtermenu</span><br><span class="line"></span><br><span class="line">POM_DESCRIPTION=Android FilterMenu Library</span><br><span class="line">POM_URL=https://github.com/linroid/FilterMenu</span><br><span class="line">POM_SCM_URL=https://github.com/linroid/FilterMenu</span><br><span class="line">POM_SCM_CONNECTION=scm:https://github.com/linroid/FilterMenu.git</span><br><span class="line">POM_SCM_DEV_CONNECTION=scm:https://github.com/linroid/FilterMenu.git</span><br><span class="line">POM_LICENCE_NAME=The Apache Software License, Version 2.0</span><br><span class="line">POM_LICENCE_URL=http://www.apache.org/licenses/LICENSE-2.0.txt</span><br><span class="line">POM_LICENCE_DIST=repo</span><br><span class="line">POM_DEVELOPER_ID=linroid</span><br><span class="line">POM_DEVELOPER_NAME=linroid</span><br><span class="line">POM_DEVELOPER_URL=http://linroid.com</span><br></pre></td></tr></table></figure>
<p>根据你的项目修改吧(‘・ω・’)</p>
</li>
<li><p><strong>添加gradle-mvn-push插件</strong><br>在 library module 的<code>build.gradle</code>文件中添加</p>
 <figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">from:</span> <span class="string">'https://raw.github.com/chrisbanes/gradle-mvn-push/master/gradle-mvn-push.gradle</span></span><br></pre></td></tr></table></figure>
<p>或者可以将 <a href="https://raw.githubusercontent.com/chrisbanes/gradle-mvn-push/master/gradle-mvn-push.gradle" target="_blank" rel="noopener">gradle-mvn-push.gradle</a> 文件下载下来，然后将上面的url该为本地路径。</p>
</li>
<li><p><strong>执行gradle task</strong><br>输入下面的命令，就可以自动构建并上传啦</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gradle clean build uploadArchives</span><br></pre></td></tr></table></figure>
<p>出现如下结果就说明上传成功了:）<br> <img src="http://cdn.linroid.com/QQ20150313-2@2x.png" alt="执行成功"><br>还没结束，此时你的库并没有发布.</p>
</li>
<li><p><strong>最后一步</strong>：close staging repositories<br>登陆 <a href="https://oss.sonatype.org/" target="_blank" rel="noopener">Sonatype Nexus Professional</a> 点开左边 Build Promotion 的 Staging Repositories ，滚到最下面找到你最新上传的(可以点Content确保是你上传的)，选中之后点击上面的 <code>Close</code> 按钮 和 <code>Release</code> 按钮(多谢<a href="http://weibo.com/drak11t" target="_blank" rel="noopener">@drak11t</a>的提示)。</p>
<p>Ok 了，还需要等待一小段时间才能在 <a href="http://search.maven.org" target="_blank" rel="noopener">http://search.maven.org</a> 搜索到你的包。</p>
</li>
</ul>
<p>##链接</p>
<ul>
<li><a href="http://central.sonatype.org/pages/ossrh-guide.html" target="_blank" rel="noopener">OSSRH Guide</a> 官方指南</li>
<li><a href="http://www.ruanyifeng.com/blog/2013/07/gpg.html" target="_blank" rel="noopener">GPG 入门教程</a></li>
<li><a href="https://github.com/chrisbanes/gradle-mvn-push" target="_blank" rel="noopener">gradle-mvn-push</a> </li>
<li><a href="https://oss.sonatype.org/" target="_blank" rel="noopener">Sonatype Nexus Professional</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2015/05/22/Internship-interview/" class="prev">PREV</a><a href="/2015/02/11/sky31radio/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'linroid';
var disqus_identifier = '2015/03/13/upload-android-library-to-moven-central/';
var disqus_title = '提交 library 项目到 Maven Central';
var disqus_url = 'http://linroid.com/2015/03/13/upload-android-library-to-moven-central/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//linroid.disqus.com/count.js" async></script><div class="copyright"><p>© 2013 - 2020 <a href="http://linroid.com">linroid</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a> <a href="http://beian.miit.gov.cn" target="_blank">粤ICP备17156215号</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-50624084-1",'auto');ga('send','pageview');</script></body></html>